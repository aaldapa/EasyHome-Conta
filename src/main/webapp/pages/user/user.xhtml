<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:c="http://java.sun.com/jsp/jstl/core">  
      
    <h:body>	
    	
    	<ui:composition template="../../templates/main.xhtml">
			<!-- Parametros para el paso de titulos, cabeceras, etc -->
			<ui:param name="headerTitle1" value="#{msg['usuarios.listado.titulo']}" />
			<ui:param name="headerTitle2" value="" />
			<ui:param name="boxTitle" value="#{msg['usuarios.form.subtitulo']}" />
			<ui:param name="boxFooter" value="" />
			
			<!-- Para la inclusion de javascript -->
			<ui:define name="scripts">
			 	
<!-- 			 	<h:outputScript library="primefaces" name="jquery/bootstrap-datepicker.js"/> -->
			 	
			 	<h:outputScript name="./plugins/datepicker/bootstrap-datepicker.js" target="head"/>
			 	<h:outputScript name="./plugins/datepicker/locales/bootstrap-datepicker.es.js" target="head"/>
			 	
			 	<h:outputStylesheet name="./plugins/datepicker/datepicker3.css" target="head"/>
			 	
			 	<script type="text/javascript">
				   $(document).ready(function(){
						//Gestion de mensajes de error
					   	estilarMessages();
						$('.fa-times-circle-o').on('click', ocultarMessage);



					   $('.date').datepicker({
 						  	format:'dd-mm-yyyy',
 						  	language: 'es',
 						  	weekStart:1,
 						 	autoclose:true,
 						  	todayHighlight:true,
 						  	showOnFocus:true,
 						  	keyboardNavigation:false
					  	});
	
					});
				</script>
			</ui:define>
			
			<ui:define name="content">
				
				<h:form id="form" styleClass="form-horizontal"  role="form">	
					<p:growl id="messages" showDetail="true" globalOnly="true"/>
					<div class="box-body">
						<div class="row">
						    
						    <div class="col-md-8 col-md-offset-2">
						      
						      	<h:inputHidden value="#{userBean.user.idUser}"></h:inputHidden>
						
								<!-- Si se trata hemos entrado al formulario mediante edicion mostramos estos campos -->
								<c:if test="#{not empty userBean.user.idUser}">
								
									<!-- Text inputs-->
									<div class="form-group">
								        <label class="col-sm-2 control-label">
								        	<h:outputLabel value="#{msg['usuarios.form.fecha.alta']}"/>
								       	</label>
								        <div class="col-sm-3">
								            <div class="input-group input-append">
								            	<h:inputText class="form-control" value="#{userBean.user.fechaCreacion}" readonly="true">
	       	             							<f:convertDateTime pattern="#{msg['patron.fecha.corta']}" />
		 					          			</h:inputText>
								                <span class="input-group-addon add-on"><span class="glyphicon glyphicon-calendar"></span></span>
								            </div>
								        </div>
								        
<!-- 								        <label class="col-sm-3 control-label" for="textinput">Ult. acceso</label> -->
<!-- 								        <div class="col-sm-4"> -->
<!-- 								            <div class="input-group input-append"> -->
<!-- 			 					         		<h:inputText class="form-control " value="#{userBean.user.ultimaConexion}" readonly="true"> -->
<!-- 	       	             							<f:convertDateTime pattern="#{msg['patron.fecha.corta.hora']}" /> -->
<!-- 		 					          			</h:inputText> -->
<!-- 								                <span class="input-group-addon add-on"><span class="glyphicon glyphicon-log-in"></span></span> -->
<!-- 								            </div> -->
<!-- 								        </div> -->
								    </div>
								
								
								</c:if>
								    
					                
       						    <!-- Text input-->
						          <div class="form-group">
						            <h:message for="id_nombre" errorClass="has-error" infoClass="has-info"/>
						            <label class="col-sm-2 control-label" for="textinput">
						            	<h:outputLabel value="#{msg['usuarios.form.nombre']}"/>
						            </label>
						            <div class="col-sm-6">
						              <h:inputText id="id_nombre" pt:placeholder="Nombre" class="form-control" label="Nombre" value="#{userBean.user.nombre}" required="true" requiredMessage="#{msg['error.campo.obligatorio']}"/>
						            </div>
						          </div>
						
						          <!-- Text input-->
						          <div class="form-group">
						            <h:message for="id_apel1" errorClass="has-error" infoClass="has-info"/>
						            <label class="col-sm-2 control-label" for="textinput">
						            	<h:outputLabel value="#{msg['usuarios.form.apel1']}"/>
						            </label>
						            <div class="col-sm-6">
						             <h:inputText id="id_apel1" pt:placeholder="1ยบ apellido" class="form-control" label="1ยบ apellido" value="#{userBean.user.apellido1}" required="true" requiredMessage="#{msg['error.campo.obligatorio']}"/>
						            </div>
						          </div>
						          
						          <!-- Text input-->
						          <div class="form-group">
						            <label class="col-sm-2 control-label" for="textinput">
						            	<h:outputLabel value="#{msg['usuarios.form.apel2']}"/>
						            </label>
						            <div class="col-sm-6">
						              <h:inputText pt:placeholder="2ยบ apellido" class="form-control" label="2ยบ apellido" value="#{userBean.user.apellido2}"/>
						            </div>
						          </div>
						
								<!-- Listado de roles -->      
								<div class="form-group">
									<label class="col-sm-2 control-label" for="textinput">
										<h:outputLabel value="#{msg['usuarios.form.roles']}"/>
									</label>
	                      			<!-- Parece ser que el bucle c:forEach de jsf no envia bien los valores del #{rol.selected} asi que usamos el ui:repeat-->
	                      			<ui:repeat var="rol" value="#{userBean.lstRoles}" varStatus="y" >
										
										<!-- la etiqueta c:set para varibles no funciona dentro de la etiqueta ui:repeat
										Para utilizar valores dinamicos de variables usamos ui:param y para evaluar la condicion
										lo hacemos dentro de la propia etiqueta -->
										<ui:param name="separacion" value="#{y.index eq 2 ? 'col-md-offset-2' : ''}"  />
										
										<div class="col-sm-4 checkbox #{separacion}">	
	                        				<label>
	                        					<h:selectBooleanCheckbox value="#{rol.selected}" />
	                          					#{rol.role}
	                          					 
	                        				</label>
	                        			</div>
	                        		</ui:repeat>								
	                      		</div>
						        
						          <!-- Text inputs-->
						          <div class="form-group">
						            
						            <label class="col-sm-2 control-label" for="textinput">
						            	<h:outputLabel value="#{msg['usuarios.form.username']}"/>
						            </label>
						            
						            <div class="col-sm-4">
						              <h:message for="id_username" errorClass="has-error" infoClass="has-info"/>
						              <h:inputText id="id_username" pt:placeholder="#{msg['usuarios.form.username']}" class="form-control" label="#{msg['usuarios.form.username']}" value="#{userBean.user.username}" required="true" requiredMessage="#{msg['error.campo.obligatorio']}"/>
						            </div>
									
									
						            <label class="col-sm-2 control-label" for="textinput">
						            	<h:outputLabel value="#{msg['usuarios.form.password']}"/>
						            </label>
						            <div class="col-sm-4">
						               <h:message for="id_password" errorClass="has-error" infoClass="has-info"/>
						               <h:inputSecret id="id_password" pt:placeholder="#{msg['usuarios.form.password']}" class="form-control" label="#{msg['usuarios.form.password']}" value="#{userBean.user.password}" redisplay="true" required="true" requiredMessage="#{msg['error.campo.obligatorio']}"/>
						            </div>
						          </div>	
						    </div><!-- /.col-lg-12 -->
						</div><!-- /.row -->
					</div><!-- /.box-body -->
					
					<!-- Para la botonera -->
			        <div class="box-footer">
 						
    					<div class="btn-toolbar">
    						<h:commandLink action="#{userBean.doListUsers}" styleClass="btn btn-default pull-right" value="#{msg['boton.volver']}" immediate="true"/>
   					 		<h:commandButton styleClass="btn btn-primary pull-right" value="#{msg['boton.guardar']}" action="#{userBean.doSaveUser}" update="id_data_table"/>
   					 	</div>
		    			
			        </div><!-- /.box-footer-->
		    	</h:form>
			</ui:define>
    	</ui:composition>
    	
    </h:body>

</html>